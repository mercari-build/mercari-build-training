# syntax=docker/dockerfile:1
FROM golang:1.18-alpine

WORKDIR /app
COPY go.mod ./
COPY go.sum ./
RUN go mod download
RUN go mod tidy
RUN apk add --no-cache gcc
RUN go get github.com/labstack/echo/v4
RUN go get github.com/labstack/echo/v4/middleware
RUN go get github.com/labstack/gommon/log
RUN go get github.com/mattn/go-sqlite3
COPY app/ ./app
# COPY image/ ./image
RUN go build ./app/main.go
# RUN go build -a -tags netgo -installsuffix netgo --ldflags '-extldflags "-static"' ./app/main.go
# RUN export CGO_ENABLED=1 

# RUN CGO_ENABLED=0 go build -o ./app

# STEP4-4では以下は変更しない
# CMD ["go", "version"]

# CMD [ "go run ./app/main.go" ]
CMD [ "./main" ]
